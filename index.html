<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indoor Humidity Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-5xl mx-auto">

      <div class="grid grid-cols-2 gap-8">

        <!-- OUTDOOR SECTION -->
        <div class="bg-green-50 rounded-lg p-6 shadow-sm border border-blue-100">
          <h2 class="text-xl font-semibold mb-6 text-gray-700">🏖 Outdoor</h2>

          <!-- Outdoor Temperature -->
          <div class="mb-8 bg-white/60 rounded-lg p-4 border border-gray-200">
            <label class="block text-sm font-medium mb-2 text-gray-600">Temperature</label>
            <div class="text-3xl font-bold mb-4 text-center" id="outdoorTempValue">15.0°C</div>
            <div class="flex items-center gap-3">
              <span class="text-2xl">❄️</span>
              <input type="range" id="outdoorTemp" min="-20" max="40" value="15" step="0.5"
                class="flex-1 h-3 rounded-full appearance-none cursor-pointer"
                style="background: linear-gradient(to right, #3b82f6, #f97316);">
              <span class="text-2xl">🔥</span>
            </div>
          </div>

          <!-- Outdoor Humidity -->
          <div class="bg-white/60 rounded-lg p-4 border border-gray-200">
            <label class="block text-sm font-medium mb-2 text-gray-600">Humidity</label>
            <div class="text-3xl font-bold mb-4 text-center" id="outdoorHumidityValue">50%</div>
            <div class="flex items-center gap-3">
              <span class="text-2xl">💧</span>
              <input type="range" id="outdoorHumidity" min="0" max="100" value="50" step="1"
                class="flex-1 h-3 rounded-lg appearance-none cursor-pointer"
                style="background: linear-gradient(to right, #bfdbfe, #1e40af);">
              <span class="text-2xl">💦</span>
            </div>
          </div>
        </div>

        <!-- INDOOR SECTION -->
        <div class="bg-amber-50 rounded-lg p-6 shadow-sm border border-amber-100">
          <h2 class="text-xl font-semibold mb-6 text-gray-700">🏠 Indoor</h2>

          <!-- Indoor Temperature -->
          <div class="mb-8 bg-white/60 rounded-lg p-4 border border-gray-200">
            <label class="block text-sm font-medium mb-2 text-gray-600">Temperature</label>
            <div class="text-3xl font-bold mb-4 text-center" id="indoorTempValue">20.0°C</div>
            <div class="flex items-center gap-3">
              <span class="text-2xl">❄️</span>
              <input type="range" id="indoorTemp" min="10" max="30" value="20" step="0.5"
                class="flex-1 h-3 rounded-lg appearance-none cursor-pointer"
                style="background: linear-gradient(to right, #3b82f6, #f97316);">
              <span class="text-2xl">🔥</span>
            </div>
          </div>

          <!-- Indoor Humidity (Output) -->
          <div class="bg-purple-100/70 rounded-lg p-4 border border-purple-200">
            <label class="block text-sm font-medium mb-2 text-gray-600">Humidity (Calculated)</label>
            <div class="text-3xl font-bold mb-4 text-center text-purple-700" id="indoorHumidityValue">--</div>
            <div class="flex items-center gap-3">
              <span class="text-2xl">💧</span>
              <input type="range" id="indoorHumidityDisplay" min="0" max="100" value="0" step="1"
                class="flex-1 h-3 rounded-lg appearance-none pointer-events-none"
                style="background: linear-gradient(to right, #bfdbfe, #1e40af);">
              <span class="text-2xl">💦</span>
            </div>
          </div>
        </div>

      </div>

      <!-- Refresh Button -->
      <div class="mt-4">
        <button id="refreshLocation" class="px-2 py-1 text-sm bg-gray-200 text-black/70 rounded-lg hover:bg-gray-300 transition-colors border border-gray-300">
          🔄 Refill Location Data
        </button>
      </div>

      <!-- Status Messages -->
      <div id="status" class="mt-3 bg-white rounded-lg p-4 shadow-sm border border-gray-200 space-y-1 text-sm hidden">
        <!-- Status messages will appear here -->
      </div>
    </div>

    <script>
      const outdoorTempSlider = document.getElementById('outdoorTemp');
      const outdoorHumiditySlider = document.getElementById('outdoorHumidity');
      const indoorTempSlider = document.getElementById('indoorTemp');

      const outdoorTempValue = document.getElementById('outdoorTempValue');
      const outdoorHumidityValue = document.getElementById('outdoorHumidityValue');
      const indoorTempValue = document.getElementById('indoorTempValue');
      const indoorHumidityValue = document.getElementById('indoorHumidityValue');
      const indoorHumidityDisplay = document.getElementById('indoorHumidityDisplay');

      function calculateIndoorHumidity() {
        const outTemp = parseFloat(outdoorTempSlider.value);
        const outHum = parseFloat(outdoorHumiditySlider.value);
        const inTemp = parseFloat(indoorTempSlider.value);

        // Handle edge case: if outdoor humidity is 0, indoor humidity is also 0
        if (outHum <= 0) {
          indoorHumidityValue.textContent = '0%';
          indoorHumidityDisplay.value = 0;
          return;
        }

        // Magnus formula for dew point
        const a = 17.27;
        const b = 237.7;
        const alpha = ((a * outTemp) / (b + outTemp)) + Math.log(outHum / 100);
        const dewPoint = (b * alpha) / (a - alpha);

        // Calculate indoor RH
        const indoorAlpha = (a * inTemp) / (b + inTemp);
        const dewPointAlpha = (a * dewPoint) / (b + dewPoint);
        const indoorRH = Math.max(0, Math.min(100, 100 * Math.exp(dewPointAlpha - indoorAlpha)));

        indoorHumidityValue.textContent = Math.round(indoorRH) + '%';

        // Update the display slider position
        indoorHumidityDisplay.value = Math.round(indoorRH);
      }

      outdoorTempSlider.addEventListener('input', () => {
        outdoorTempValue.textContent = parseFloat(outdoorTempSlider.value).toFixed(1) + '°C';
        calculateIndoorHumidity();
      });

      outdoorHumiditySlider.addEventListener('input', () => {
        outdoorHumidityValue.textContent = outdoorHumiditySlider.value + '%';
        calculateIndoorHumidity();
      });

      indoorTempSlider.addEventListener('input', () => {
        indoorTempValue.textContent = parseFloat(indoorTempSlider.value).toFixed(1) + '°C';
        calculateIndoorHumidity();
      });

      // Auto-fetch location on page load
      async function autoFillLocation() {
        const statusDiv = document.getElementById('status');
        statusDiv.innerHTML = '';
        statusDiv.classList.remove('hidden');

        function addStatus(message, status) {
          const div = document.createElement('div');
          div.className = status === 'loading' ? 'text-gray-600' :
            status === 'success' ? 'text-green-600 font-medium' :
              'text-red-600 font-medium';
          div.textContent = message;
          statusDiv.appendChild(div);
        }

        addStatus('Getting location...', 'loading');

        if (!navigator.geolocation) {
          addStatus('Geolocation not supported', 'error');
          return;
        }

        navigator.geolocation.getCurrentPosition(async (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          addStatus(`Location acquired: ${lat.toFixed(4)}, ${lon.toFixed(4)}`, 'success');
          addStatus(`Accuracy: ±${position.coords.accuracy.toFixed(0)}m`, 'success');

          addStatus('Fetching weather data...', 'loading');
          const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m&timezone=auto`;

          try {
            const response = await fetch(apiUrl);

            if (!response.ok) {
              throw new Error(`API returned ${response.status}`);
            }

            const data = await response.json();
            addStatus(`Timezone: ${data.timezone}`, 'success');
            addStatus(`Temperature: ${data.current.temperature_2m}°C`, 'success');
            addStatus(`Humidity: ${data.current.relative_humidity_2m}%`, 'success');

            outdoorTempSlider.value = data.current.temperature_2m;
            outdoorHumiditySlider.value = data.current.relative_humidity_2m;
            outdoorTempValue.textContent = data.current.temperature_2m.toFixed(1) + '°C';
            outdoorHumidityValue.textContent = data.current.relative_humidity_2m + '%';

            calculateIndoorHumidity();

          } catch (error) {
            addStatus('Failed to fetch weather data: ' + error.message, 'error');
          }

        }, (error) => {
          addStatus('Location error: ' + error.message, 'error');
        });
      }

      // Initial calculation
      calculateIndoorHumidity();

      // Auto-fetch location when page loads
      autoFillLocation();

      // Refresh button event listener
      document.getElementById('refreshLocation').addEventListener('click', () => {
        autoFillLocation();
      });
    </script>

    <style>
      input[type="range"]::-webkit-slider-thumb {
        appearance: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: white;
        cursor: pointer;
        border: 3px solid #6366f1;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      input[type="range"]::-moz-range-thumb {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: white;
        cursor: pointer;
        border: 3px solid #6366f1;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      /* Indoor humidity display slider - same style but purple */
      #indoorHumidityDisplay::-webkit-slider-thumb {
        appearance: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: white;
        cursor: default;
        border: 3px solid #7c3aed;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      #indoorHumidityDisplay::-moz-range-thumb {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: white;
        cursor: default;
        border: 3px solid #7c3aed;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
    </style>
  </body>

</html>